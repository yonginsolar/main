<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
   <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div id="loadingOverlay"><div class="spinner"></div><div style="font-weight:bold; color:#555;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div></div>
    <div id="layer"><div style="cursor:pointer;position:absolute;right:0;top:0;width:40px;height:40px;background:#333;color:white;text-align:center;line-height:40px;" onclick="document.getElementById('layer').style.display='none'">Ã—</div></div>

    <div class="container">
      
      <div id="loginSection">
          <div style="background:#e3f2fd; color:#1565c0; padding:20px; border-radius:12px; margin-bottom:20px; font-size:14px; line-height:1.5;">
            <b>ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, ì¡°í•©ì›ë‹˜!</b><br>ë³¸ì¸ í™•ì¸ì„ ìœ„í•´ ì¡°í•©ì› ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.<br><br>ë¬¸ì˜: ì‚¬ë¬´êµ­ì¥ ê¹€ë¯¼í˜¸ 010-2513-5736
          </div>
          <div class="section-card">
            <label>ì¡°í•©ì› ë²ˆí˜¸</label>
            <div class="box-row">
              <input type="text" id="memberIdInput" placeholder="ì˜ˆ: 2025-01-0001" oninput="handleMemberIdInput(this)" onkeyup="if(event.key==='Enter') handleSearch()">
              <button class="btn-main" id="btnSearch" style="width:auto; padding:12px 20px;" onclick="handleSearch()">ì¡°íšŒ</button>
            </div>
            <div style="font-size:11px; color:#888; margin-top:4px;">ìˆ«ìë§Œ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.</div>

            <button class="btn-kakao" onclick="startKakaoLogin()">
               <svg viewBox="0 0 32 32" width="20" height="20"><path d="M16 4C9.922 4 5 8.014 5 12.964c0 3.197 2.067 6.007 5.223 7.575-.246.914-.888 3.321-.916 3.496-.046.302.109.432.288.432.124 0 .201-.034.303-.099 3.498-2.31 5.093-3.414 5.263-3.525.55.082 1.115.122 1.688.122 6.078 0 11-4.014 11-8.964S22.078 4 16 4z" fill="#000000"></path></svg>
               ì¹´ì¹´ì˜¤ë¡œ 3ì´ˆ ë§Œì— ì‹œì‘í•˜ê¸°
            </button>

            <button class="btn-naver" id="btnNaverHidden" onclick="startNaverLogin()" style="background:#03C75A; color:white; width:100%; padding:14px; border-radius:10px; font-weight:bold; border:none; cursor:pointer; margin-top:10px; display:none !important;">
               <span style="font-weight:900; font-size:16px; margin-right:5px;">N</span>
               ë„¤ì´ë²„ë¡œ ì‹œì‘í•˜ê¸°
            </button>
            
            <div id="emailAuthArea" class="hidden" style="margin-top:20px; border-top:1px dashed #eee; padding-top:20px;">
              <label>ë“±ë¡ëœ ì´ë©”ì¼</label>
              <div class="box-row" style="background:#f8f9fa; padding:10px; border-radius:8px; border:1px solid #eee;">
                <input type="text" id="emailDisplay" readonly style="background:transparent; border:none; padding:0; color:#555; flex:1;">
                <button class="btn-sub" id="btnSendAuth" onclick="requestAuth()">ì¸ì¦ë²ˆí˜¸ ë°›ê¸°</button>
              </div>
              
              <div id="authInputBox" class="hidden" style="margin-top:15px;">
                <div class="box-row">
                  <input type="text" id="authCode" placeholder="ì¸ì¦ë²ˆí˜¸ 6ìë¦¬" style="text-align:center; letter-spacing:3px;" oninput="clearError('loginAuthMsg')" onkeyup="handleAuthEnter(event)">
                  <button class="btn-main" style="width:80px;" onclick="verifyAuth()">í™•ì¸</button>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                   <div id="loginAuthMsg" class="error-msg"></div>
                   <div style="color:red; font-size:12px; margin-top:5px;" id="timer">05:00</div>
                </div>
              </div>
            </div>
          </div>
      </div>

      <div id="kakaoLinkSection" class="hidden">
          <div style="background:#FEE500; color:#3b1e1e; padding:20px; border-radius:12px; margin-bottom:20px; font-size:14px; line-height:1.5;">
            <b>âš¡ ì¹´ì¹´ì˜¤ ê³„ì • ì—°ë™</b><br>
            ì²« ë°©ë¬¸ì´ì‹œêµ°ìš”! ë³¸ì¸ í™•ì¸ì„ ìœ„í•´<br>
            <b>ì¡°í•©ì› ë²ˆí˜¸ë¥¼ 1íšŒ ì…ë ¥</b>í•´ì£¼ì„¸ìš”.
          </div>
          <div class="section-card">
            <label>ì—°ë™í•  ì¡°í•©ì› ë²ˆí˜¸</label>
            <div class="box-row">
              <input type="text" id="linkMemberId" placeholder="ì˜ˆ: 2025-01-0001" oninput="handleMemberIdInput(this)">
              <button class="btn-main" id="btnLinkSearch" style="width:auto; padding:12px 20px;" onclick="handleLinkSearch()">ì¡°íšŒ</button>
            </div>
            
            <div id="linkEmailArea" class="hidden" style="margin-top:20px; border-top:1px dashed #eee; padding-top:20px;">
              <label>ë³¸ì¸ í™•ì¸ (ì´ë©”ì¼)</label>
              <div class="box-row" style="background:#f8f9fa; padding:10px; border-radius:8px; border:1px solid #eee;">
                 <input type="text" id="linkEmailDisplay" readonly style="background:transparent; border:none; padding:0; color:#555; flex:1;">
                 <button class="btn-sub" id="btnLinkSend" onclick="requestLinkAuth()">ì¸ì¦ë²ˆí˜¸ ë°›ê¸°</button>
              </div>
              
              <div id="linkAuthBox" class="hidden" style="margin-top:15px;">
                 <div class="box-row">
                   <input type="text" id="linkAuthCode" placeholder="ì¸ì¦ë²ˆí˜¸ 6ìë¦¬" style="text-align:center; letter-spacing:3px;">
                   <button class="btn-main" style="width:80px;" onclick="verifyLinkAuth()">ì—°ë™í•˜ê¸°</button>
                 </div>
                 <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div id="linkMsg" class="error-msg"></div>
                    <div style="color:red; font-size:12px; margin-top:5px;" id="linkTimer">05:00</div>
                 </div>
              </div>
            </div>

            <div style="margin-top:20px; text-align:center;">
               <button class="btn-sub" onclick="cancelKakaoLink()">ì·¨ì†Œí•˜ê³  ëŒì•„ê°€ê¸°</button>
            </div>
          </div>
      </div>

      <div id="dashboardSection" class="hidden">
          <div class="top-util-bar">
              <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
          </div>

          <div class="section-card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
              <div style="display:flex; align-items:center; gap:8px;">
                <span style="font-size:18px; font-weight:bold;">ë‚´ ì •ë³´</span>
                <button class="btn-sub" style="padding:4px 8px; font-size:11px;" onclick="refresh()">â†» ìƒˆë¡œê³ ì¹¨</button>
              </div>
              <span style="font-size:10px; color:#999;">(30ë¶„ ë¯¸ì‚¬ìš© ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ)</span>
            </div>
            
            <div class="summary-box">
              <div id="birthdayBanner"></div>

              <div class="summary-row"><span>ì´ë¦„</span><span id="sumName"></span></div>
              <div class="summary-row"><span>ë²ˆí˜¸</span><span id="sumId"></span></div>
              <div class="summary-row"><span>ì´ë©”ì¼</span><span id="sumEmail"></span></div>
              <div class="summary-row"><span>ì—°ë½ì²˜</span><span id="sumPhone"></span></div>
              <div class="summary-row"><span>ì£¼ì†Œ</span><span id="sumAddr" style="max-width:200px; text-align:right;"></span></div>
              <div class="summary-row" style="margin-top:10px; border-top:1px dashed #ddd; padding-top:5px;">
                <span>ë°°ë‹¹ ê³„ì¢Œ</span><span id="sumAccount" style="color:#1967d2;"></span>
              </div>
            </div>
            <button class="btn-sub" style="width:100%; border:1px solid var(--primary-color); color:var(--primary-color);" id="btnEditInfo" onclick="openEditModal()">ë‚´ ì •ë³´ ìˆ˜ì •</button>
            
            <div class="summary-box" style="margin-top:15px; background:#e8f0fe; border-color:#d2e3fc;">
              <div class="summary-row">
                <span style="color:#1967d2;">ë‚©ë¶€ ì¶œìê¸ˆ</span>
                <span id="sumTotal" style="color:#1967d2; font-size:16px;"></span>
              </div>
            </div>
            <div class="summary-box" style="background:#fff; border:1px solid #eee;">
              <div style="font-weight:bold; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">ì…ê¸ˆ ë‚´ì—­</div>
              <div id="depositList" style="font-size:13px; color:#555;"></div>
            </div>
          </div>

          <div class="menu-grid">
            <button class="menu-btn" onclick="toggleTab('extra', this)">ì¶”ê°€ ì¶œì</button>
            <button class="menu-btn" onclick="toggleTab('reduction', this)">ê°ì ì‹ ì²­</button>
            <button class="menu-btn" onclick="toggleTab('withdraw', this)">íƒˆí‡´ ì‹ ì²­</button>
            <button class="menu-btn" onclick="toggleTab('cert', this)" style="color:var(--primary-color);">ğŸ–¨ï¸ ì¦ëª…ì„œ</button>
          </div>

          <div id="tabExtra" class="section-card hidden">
            <h3>ì¶”ê°€ ì¶œì ì‹ ì²­</h3>
            <div class="notice-box">
               ğŸ’¡ <b>ì…ê¸ˆì ì‹ë³„</b>ì„ ìœ„í•´ ì‘ì„±í•˜ëŠ” ì‹ ì²­ì„œì…ë‹ˆë‹¤.<br>
               ì¶œìê¸ˆì„ ì…ê¸ˆí•˜ì…¨ë‹¤ë©´ ë°˜ë“œì‹œ ì‘ì„±í•´ ì£¼ì„¸ìš”!
            </div>
            
            <div class="input-group"><label>ì•½ì •ê¸ˆì•¡ (1ë§Œì› ë‹¨ìœ„)</label>
              <input type="number" id="exAmount" step="10000" min="0" oninput="handleAmountInput(this, 'extra')">
              <div id="exHint" style="font-size:12px; color:#666; margin-top:4px;"></div>
            </div>
            <div class="input-group">
              <label>ì…ê¸ˆìƒíƒœ</label>
              <div class="radio-group">
                <label class="check-item"><input type="radio" name="exPaid" value="yes" checked onclick="toggleBankInfo(false)"> ì…ê¸ˆì™„ë£Œ</label>
                <label class="check-item"><input type="radio" name="exPaid" value="no" onclick="toggleBankInfo(true)"> ë‚˜ì¤‘ì— ì…ê¸ˆ</label>
              </div>
            </div>
            <div id="bankInfoBox" class="hidden" style="background:#fff3e0; padding:10px; border-radius:5px; font-size:13px; color:#e65100; margin-bottom:15px;">
              <b>[ì…ê¸ˆí•˜ì‹¤ ê³³]</b><br>ê³„ì¢Œ ê°œì„¤ ì§„í–‰ ì¤‘ (ì¶”í›„ ë¬¸ì ì•ˆë‚´)
            </div>
            <div style="margin-bottom:15px;" class="check-item">
              <input type="checkbox" id="exAgree"> <label for="exAgree" style="margin:0; font-weight:normal;">ì •ê´€ì— ë”°ë¼ ì¶”ê°€ ì¶œìë¥¼ ì‹ ì²­í•©ë‹ˆë‹¤.</label>
            </div>
            <button class="btn-main" onclick="submitExtra(this)">ì‹ ì²­í•˜ê¸°</button>
          </div>

          <div id="tabReduction" class="section-card hidden">
            <h3>ê°ì ì‹ ì²­</h3>
            <div class="summary-box">ê°€ëŠ¥ì•¡: <span id="redMax" style="color:red; font-weight:bold;"></span></div>
            <div id="redList"></div>
            <div style="background:#fff3e0; color:#e65100; padding:10px; border-radius:5px; font-size:13px; margin:10px 0;">â€» ë“±ë¡ëœ ë°°ë‹¹ ê³„ì¢Œë¡œ ì…ê¸ˆë©ë‹ˆë‹¤.</div>
            <div class="input-group"><label>ì‹ ì²­ê¸ˆì•¡</label>
              <input type="number" id="redAmount" step="10000" min="0" oninput="handleAmountInput(this, 'reduction')">
              <div id="redHint" style="font-size:12px; color:#666; margin-top:4px;"></div>
            </div>
            <div style="margin-bottom:10px;" class="check-item">
              <input type="checkbox" id="redAgree"> 
              <label for="redAgree" style="margin:0; font-weight:normal; font-size:13px; color:#555;">ê°ìëŠ” ë‹¤ìŒë…„ë„ ì´íšŒ ìŠ¹ì¸ í›„ ì²˜ë¦¬ë˜ë©°, ìì‚° ìƒí™©ì— ë”°ë¼ í™˜ê¸‰ì•¡ì´ ì¡°ì •ë  ìˆ˜ ìˆìŒì„ í™•ì¸í•©ë‹ˆë‹¤.</label>
            </div>
            <button class="btn-main" id="btnSubmitRed" onclick="submitReduction(this)">ì‹ ì²­í•˜ê¸°</button>
          </div>

          <div id="tabWithdraw" class="section-card hidden">
            <h3>íƒˆí‡´ ì‹ ì²­</h3>
            <div id="wdList"></div>
            <div style="background:#fff3e0; color:#e65100; padding:10px; border-radius:5px; font-size:13px; margin:10px 0;">â€» ë“±ë¡ëœ ë°°ë‹¹ ê³„ì¢Œë¡œ ì…ê¸ˆë©ë‹ˆë‹¤.</div>
            <div class="input-group"><label>ì‚¬ìœ </label><textarea id="wdReason"></textarea></div>
            <div style="margin-bottom:10px;" class="check-item">
              <input type="checkbox" id="wdAgree"> 
              <label for="wdAgree" style="margin:0; font-weight:normal; font-size:13px; color:#555;">íƒˆí‡´ëŠ” ë‹¤ìŒë…„ë„ ì´íšŒ ìŠ¹ì¸ í›„ ì²˜ë¦¬ë˜ë©°, ìì‚° ìƒí™©ì— ë”°ë¼ í™˜ê¸‰ì•¡ì´ ì¡°ì •ë  ìˆ˜ ìˆìŒì„ í™•ì¸í•©ë‹ˆë‹¤.</label>
            </div>
            <button class="btn-main" onclick="submitWithdraw(this)">ì‹ ì²­í•˜ê¸°</button>
          </div>

          <div id="tabCert" class="section-card hidden">
            <h3>ì¦ëª…ì„œ ë°œê¸‰ ì„¼í„°</h3>
            
            <div class="notice-box">
               âš ï¸ <b>ì¶œì ì¦ì„œ ë°œê¸‰ ì•ˆë‚´</b><br>
               ì¶œìê¸ˆ ë‚©ë¶€ í›„ ì‚¬ë¬´ì²˜ í™•ì¸ ì™„ë£Œê¹Œì§€ <b>1~2ì˜ì—…ì¼</b>ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>

            <div style="background:#f1f8ff; padding:20px; border-radius:10px; margin:20px 0; border:1px solid #d2e3fc; text-align:center;">
              <div style="font-size:16px; font-weight:bold; color:#1565c0; margin-bottom:5px;">ğŸ“„ ì¶œìì¦ì„œ</div>
            </div>

            <div style="display:flex; gap:10px;">
              <button class="btn-main" style="width:100%;" onclick="downloadCert(this)">
                â¬‡ï¸ ë‹¤ìš´ë¡œë“œ
              </button>
            </div>
          </div>
          
          <div class="footer-contact">
             ë¬¸ì˜ : ì‚¬ë¬´êµ­ì¥ ê¹€ë¯¼í˜¸ 010-2513-5736 / yonginsolar@gmail.com
          </div>
      </div>
    </div>

    <div id="editModal" class="modal">
      <div class="modal-content">
        <div style="position:absolute; top:15px; right:20px; font-size:24px; cursor:pointer;" onclick="document.getElementById('editModal').style.display='none'">Ã—</div>
        <h3 style="border-bottom:2px solid #4e8cff; padding-bottom:10px; color:#333;">ì •ë³´ ìˆ˜ì •</h3>
        
        <label>ì£¼ì†Œ ë³€ê²½ (í˜„ì¬ ì£¼ì†Œ: <span id="displayAddr" style="font-weight:normal; color:#666;"></span>)</label>
        <div class="box-row" style="margin-bottom:5px;">
           <input type="text" id="editPostcode" readonly style="width:80px;" placeholder="ìš°í¸ë²ˆí˜¸">
           <button class="btn-sub" onclick="execPostcode()">ì£¼ì†Œ ê²€ìƒ‰</button>
        </div>
        <input type="text" id="editRoad" readonly style="margin-bottom:5px;" placeholder="ì£¼ì†Œ ê²€ìƒ‰ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”">
        <input type="text" id="editDetail" placeholder="ìƒì„¸ì£¼ì†Œ ì…ë ¥">

        <label style="margin-top:15px;">ì—°ë½ì²˜ ë³€ê²½</label>
        <input type="text" id="editPhone" placeholder="" oninput="handlePhoneInput(this)">

        <label style="margin-top:15px;">ì´ë©”ì¼ ë³€ê²½</label>
        <div class="box-row">
          <input type="email" id="editEmail" placeholder="" oninput="handleEmailChange()">
          <button class="btn-sub" id="btnEditAuth" disabled onclick="reqEditAuth()">ì¸ì¦ë²ˆí˜¸ ë°›ê¸°</button>
        </div>
        <div id="editAuthBox" class="hidden" style="margin-top:5px;">
           <div class="box-row">
             <input type="text" id="editAuthCode" placeholder="ì¸ì¦ë²ˆí˜¸" oninput="clearError('editAuthMsg')">
             <button class="btn-main" style="width:60px;" onclick="verifyEditAuth()">í™•ì¸</button>
           </div>
           <div id="editAuthMsg" class="error-msg"></div>
        </div>
        <input type="hidden" id="emailAuthDone" value="true">

        <label style="margin-top:15px; padding-top:15px; border-top:1px dashed #ddd;">ë°°ë‹¹ê¸ˆ ê³„ì¢Œ ë³€ê²½</label>
        <select id="editBank" style="margin-bottom:5px;">
           <option value="">ì€í–‰ì„ íƒ</option>
           <option value="ë†í˜‘">ë†í˜‘</option><option value="êµ­ë¯¼">êµ­ë¯¼</option><option value="ì‹ í•œ">ì‹ í•œ</option><option value="ìš°ë¦¬">ìš°ë¦¬</option>
           <option value="í•˜ë‚˜">í•˜ë‚˜</option><option value="ê¸°ì—…">ê¸°ì—…</option><option value="ì¹´ì¹´ì˜¤ë±…í¬">ì¹´ì¹´ì˜¤ë±…í¬</option><option value="í† ìŠ¤ë±…í¬">í† ìŠ¤ë±…í¬</option>
           <option value="ìƒˆë§ˆì„">ìƒˆë§ˆì„</option><option value="ì‹ í˜‘">ì‹ í˜‘</option><option value="ìš°ì²´êµ­">ìš°ì²´êµ­</option>
        </select>
        <input type="text" id="editAccount" placeholder="ê³„ì¢Œë²ˆí˜¸ (ìˆ«ìë§Œ)" oninput="handleNumberOnly(this)" onfocus="this.select()">
        <div style="font-size:11px; color:#666; margin-top:2px; margin-bottom:5px;">â€» í‰ìƒê³„ì¢Œ(íœ´ëŒ€í°ë²ˆí˜¸)ë³´ë‹¤ëŠ” <b>ì‹¤ì œ ê³„ì¢Œë²ˆí˜¸</b> ì…ë ¥ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</div>
        <input type="text" id="editHolder" placeholder="ì˜ˆê¸ˆì£¼" style="margin-top:5px;" onfocus="this.select()">
        
        <button class="btn-main" style="margin-top:20px;" id="btnSaveInfo" onclick="saveInfo(this)">ì €ì¥í•˜ê¸°</button>
      </div>
    </div>

    <div id="consentModal" class="modal">
      <div class="modal-content">
        <h3 style="color:#d32f2f; margin-top:0;">âš ï¸ ì•ˆë‚´ ë° ë™ì˜</h3>
        <div id="consentText" style="background:#fff3e0; padding:15px; border-radius:8px; font-size:14px; line-height:1.5; color:#333;">
          </div>
        <div class="check-item" style="margin-top:20px; padding:10px; border:1px solid #ddd; border-radius:8px;">
          <input type="checkbox" id="modalAgreeCheck" onclick="document.getElementById('btnConsentConfirm').disabled = !this.checked">
          <label for="modalAgreeCheck" style="margin:0; font-weight:bold;">ë„¤, ë‚´ìš©ì„ í™•ì¸í•˜ì˜€ìœ¼ë©° ì´ì— ë™ì˜í•©ë‹ˆë‹¤.</label>
        </div>
        <div style="margin-top:20px; display:flex; gap:10px;">
           <button class="btn-sub" style="flex:1;" onclick="document.getElementById('consentModal').style.display='none'">ì·¨ì†Œ</button>
           <button class="btn-main" style="flex:1;" id="btnConsentConfirm" disabled>í™•ì¸</button>
        </div>
      </div>
    </div>

    <div id="alertModal" class="modal"><div class="modal-content" style="text-align:center;"><div id="alertMsg" style="margin-bottom:15px; white-space:pre-wrap;"></div><div id="alertBtns"><button class="btn-main" onclick="document.getElementById('alertModal').style.display='none'">í™•ì¸</button></div></div></div>

    <div id="centerModal" class="modal">
      <div class="modal-content">
        <div style="font-size:40px; margin-bottom:10px;">âœ‹</div> 
        <div id="centerMsg" style="margin-bottom:15px; white-space:pre-wrap; font-size:15px; color:#333; line-height:1.5;"></div>
        <button type="button" class="btn-main" style="width:100%;" onclick="document.getElementById('centerModal').style.display='none'">í™•ì¸</button>
      </div>
    </div>
<script>
      // í˜ì´ì§€ê°€ ë¡œë“œë˜ìë§ˆì ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
      window.addEventListener('DOMContentLoaded', function() {
          const params = new URLSearchParams(window.location.search);
          
          // 'already_member'ë¼ëŠ” ê¼¬ë¦¬í‘œê°€ ë¶™ì–´ì„œ ì™”ëŠ”ì§€ í™•ì¸
          if (params.get('msg') === 'already_member') {
              // [ìˆ˜ì • ì™„ë£Œ] alert ëŒ€ì‹  ê¸°ì¡´ì— ìˆëŠ” ì˜ˆìœ ëª¨ë‹¬(showAlert)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
              // showAlert í•¨ìˆ˜ëŠ” ì•„ë˜ì— ì •ì˜ë˜ì–´ ìˆì§€ë§Œ, í˜¸ì¶œ ì‹œì ì—ëŠ” ë¬¸ì œì—†ì´ ì‘ë™í•©ë‹ˆë‹¤.
              setTimeout(function() { 
                showAlert("ğŸ‘‹ ì´ë¯¸ ê°€ì…ëœ íšŒì›ì…ë‹ˆë‹¤.\nê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.");
              }, 100);
              
              // 2. ì£¼ì†Œì°½ ì²­ì†Œ (ìƒˆë¡œê³ ì¹¨ í•´ë„ ë˜ ëœ¨ì§€ ì•Šê²Œ)
              const cleanUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
              window.history.replaceState({ path: cleanUrl }, '', cleanUrl);
          }
      });

      // âš ï¸ ì—¬ê¸°ì— ë°°í¬í•œ ì•±ìŠ¤í¬ë¦½íŠ¸ ì›¹ ì•± URLì„ ë„£ìœ¼ì„¸ìš”!
      const API_URL = "https://script.google.com/macros/s/AKfycbyB4YxiojN5ZsY3NDRxa6-LTBL7y8Ae_h182lm1Czl0567WGzEXhGP-RRHWXZdIkWXi/exec";
      // [ì‹ ê·œ] ì¹´ì¹´ì˜¤ ì•±í‚¤ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸ URI ìƒìˆ˜
      const KAKAO_KEY = "22abc7108d7d6517e2abe1ddf382f842";
      const REDIRECT_URI = "https://minho-kim.github.io/yongin-solar-web/callback.html";
                        

      // [í†µì‹  í—¬í¼] ì•±ìŠ¤í¬ë¦½íŠ¸ì™€ ëŒ€í™”í•˜ëŠ” í•¨ìˆ˜
      async function callApi(action, payload) {
        try {
          const response = await fetch(API_URL, {
            method: "POST",
            redirect: "follow",
            headers: { "Content-Type": "text/plain;charset=utf-8" },
            body: JSON.stringify(Object.assign({ action: action }, payload))
          });
          return await response.json();
        } catch (error) {
          console.error("API Error:", error);
          throw new Error("ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      var curMem = null, curData = null, timer = null, canSend = true;
      var currentAuthCode = "";
      
      var logoutTimer = null;
      const LOGOUT_TIME = 30 * 60 * 1000; 

      // [ì‹ ê·œ] ì¹´ì¹´ì˜¤ ì—°ë™ ê´€ë ¨ ë³€ìˆ˜
      var kakaoPollTimer = null;
      var currentKakaoState = "";
      var pendingKakaoId = ""; // ì—°ë™ ëŒ€ê¸° ì¤‘ì¸ ì¹´ì¹´ì˜¤ ID

      function showLoading(show) { document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none'; }
      function clearError(id) { document.getElementById(id).innerText = ''; }

      function showAlert(msg, callback) {
        document.getElementById('centerMsg').innerHTML = msg.replace(/\n/g, '<br>');
        var modal = document.getElementById('centerModal');
        var btn = modal.querySelector('button');
        btn.onclick = function() { modal.style.display='none'; if(callback) callback(); };
        modal.style.display = 'flex';
      }
      
      function showConfirm(msg, yesCallback) {
        document.getElementById('alertMsg').innerHTML = msg.replace(/\n/g, '<br>');
        var btnArea = document.getElementById('alertBtns');
        btnArea.innerHTML = '';
        var yes = document.createElement('button'); yes.className='btn-main'; yes.innerText='ë„¤'; yes.style.width='45%'; yes.style.marginRight='10px';
        yes.onclick = function() { document.getElementById('alertModal').style.display='none'; yesCallback(); };
        var no = document.createElement('button'); no.className='btn-sub'; no.innerText='ì•„ë‹ˆì˜¤'; no.style.width='45%';
        no.onclick = function() { document.getElementById('alertModal').style.display='none'; };
        btnArea.appendChild(yes); btnArea.appendChild(no);
        document.getElementById('alertModal').style.display = 'flex';
      }

      function resetLogoutTimer() {
        if(document.getElementById('dashboardSection').classList.contains('hidden')) return;
        
        clearTimeout(logoutTimer);
        logoutTimer = setTimeout(function() {
           showAlert("ì¥ì‹œê°„(30ë¶„) ë¯¸ì‚¬ìš©ìœ¼ë¡œ\nìë™ ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.", function(){
              location.reload();
           });
        }, LOGOUT_TIME);
      }

      window.onload = function() {
        document.body.addEventListener('mousemove', resetLogoutTimer);
        document.body.addEventListener('mousedown', resetLogoutTimer);
        document.body.addEventListener('keypress', resetLogoutTimer);
        document.body.addEventListener('touchmove', resetLogoutTimer);
      };

      function handleMemberIdInput(el) {
        var v = el.value.replace(/[^0-9]/g, '');
        if (v.length > 4 && v.length <= 6) { v = v.slice(0,4) + '-' + v.slice(4); } 
        else if (v.length > 6) { v = v.slice(0,4) + '-' + v.slice(4,6) + '-' + v.slice(6,10); }
        el.value = v;
      }

      function handlePhoneInput(el) {
        var v = el.value.replace(/[^0-9]/g, '');
        if (v.startsWith('02')) { 
             if(v.length > 2 && v.length <= 5) v = v.slice(0,2)+'-'+v.slice(2);
             else if(v.length > 5 && v.length <= 9) v = v.slice(0,2)+'-'+v.slice(2,5)+'-'+v.slice(5,9);
             else if(v.length > 9) v = v.slice(0,2)+'-'+v.slice(2,6)+'-'+v.slice(6,10);
        } else {
             if(v.length > 3 && v.length <= 7) v = v.slice(0,3)+'-'+v.slice(3);
             else if(v.length > 7) {
                 if(v.length === 11) v = v.slice(0,3)+'-'+v.slice(3,7)+'-'+v.slice(7,11); 
                 else if(v.length === 10) v = v.slice(0,3)+'-'+v.slice(3,6)+'-'+v.slice(6,10);
                 else v = v.slice(0,3)+'-'+v.slice(3,7)+'-'+v.slice(7); 
             }
        }
        el.value = v;
      }

      function handleNumberOnly(el) { el.value = el.value.replace(/[^0-9]/g, ''); }
      
      function handleAmountInput(el, type) {
        el.value = el.value.replace(/[^0-9]/g, ''); 
        var v = Number(el.value);
        var hintId = el.id === 'exAmount' ? 'exHint' : 'redHint';
        var hintText = (v>=10000)?v.toLocaleString()+'ì›':'';
        
        if(type === 'reduction') {
           var max = curData.reduction.maxAdditional || 0;
           var btn = document.getElementById('btnSubmitRed');
           
           if(v > max) {
              hintText = "âš ï¸ ê°€ëŠ¥ ê¸ˆì•¡ ì´ˆê³¼ (" + max.toLocaleString() + "ì› ê¹Œì§€)";
              document.getElementById(hintId).style.color = "red";
              btn.disabled = true;
           } else {
              document.getElementById(hintId).style.color = "#666";
              btn.disabled = false;
              if(v >= 10000) hintText = v.toLocaleString() + 'ì›';
           }
        }
        document.getElementById(hintId).textContent = hintText;
      }
      function toggleBankInfo(show) { document.getElementById('bankInfoBox').style.display = show ? 'block' : 'none'; }

      // [ë³€ê²½] fetch ì¡°íšŒ
      function handleSearch() {
        var id = document.getElementById('memberIdInput').value;
        if(!id) return showAlert('ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        showLoading(true);
        
        callApi('getMemberForManage', { id: id })
          .then(res => {
            showLoading(false);
            if(!res.success) return showAlert(res.message);
            curMem = res.member;
            document.getElementById('emailAuthArea').classList.remove('hidden');
            document.getElementById('emailDisplay').value = curMem.email;
            document.getElementById('authCode').value = '';
            clearError('loginAuthMsg');
          })
          .catch(err => {
            showLoading(false);
            showAlert('ì˜¤ë¥˜: ' + err.message);
          });
      }

      // [ë³€ê²½] fetch ì¸ì¦ë²ˆí˜¸ ìš”ì²­
      function requestAuth() {
        if(!canSend) { showAlert('ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); return; }
        
        showLoading(true); 
        canSend = false; 
        setTimeout(()=>{canSend=true;}, 3000);

        callApi('sendExtraEmailAuth', { id: curMem.id })
          .then(res => {
            showLoading(false); 
            if(res.result === 'SENT') {
              document.getElementById('authInputBox').classList.remove('hidden');
              startTimer(300);
              document.getElementById('authCode').focus();
              showAlert('ì¸ì¦ë²ˆí˜¸ê°€ ë©”ì¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else if (res.result === 'NOT_FOUND') {
              showAlert('í•´ë‹¹ ë²ˆí˜¸ì˜ ì¡°í•©ì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            } else {
              showAlert('ë°œì†¡ ì‹¤íŒ¨: ' + res.result);
            }
          })
          .catch(err => {
             showLoading(false); 
             showAlert('ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\në‚´ìš©: ' + err.message);
          });
      }

      function startTimer(sec) {
        clearInterval(timer);
        var t = sec;
        timer = setInterval(function() {
          var m = parseInt(t/60), s = t%60;
          document.getElementById('timer').textContent = m + ":" + (s<10?"0"+s:s);
          if(--t < 0) clearInterval(timer);
        }, 1000);
      }

      function handleAuthEnter(e) {
        if(e.key === 'Enter') {
           var alertDisplay = document.getElementById('alertModal').style.display;
           var centerDisplay = document.getElementById('centerModal').style.display;
           if(alertDisplay !== 'flex' && alertDisplay !== 'block' && centerDisplay !== 'flex') {
             verifyAuth();
           }
        }
      }

      // [ë³€ê²½] fetch ì¸ì¦ë²ˆí˜¸ í™•ì¸ ë° ë°ì´í„° ë¡œë“œ
      function verifyAuth() {
        var codeEl = document.getElementById('authCode');
        var btnEl = document.querySelector('#authInputBox .btn-main'); 
        var msgEl = document.getElementById('loginAuthMsg');
        
        var code = codeEl.value;
        msgEl.innerText = ''; 
        
        if(code.length < 6) { msgEl.innerText = 'ì¸ì¦ë²ˆí˜¸ 6ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'; return; }
        
        codeEl.disabled = true;
        btnEl.disabled = true;
        btnEl.innerText = 'í™•ì¸ì¤‘';
        
        currentAuthCode = code;
        
        showLoading(true);
        callApi('verifyAuthAndLoadData', { id: curMem.id, email: curMem.email, code: code })
          .then(res => {
            showLoading(false);
            
            if(res.success) {
                msgEl.innerText = '';
                curData = res;
                curMem.email = res.realEmail;
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('dashboardSection').classList.remove('hidden');
                renderDash();
                resetLogoutTimer();
            } else {
                codeEl.disabled = false;
                btnEl.disabled = false;
                btnEl.innerText = 'í™•ì¸';
                codeEl.focus();

                if (res.message.includes("ë§Œë£Œ")) { 
                   msgEl.innerText = 'ì¸ì¦ ì‹œê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                } else if (res.message.includes("FAIL")) {
                   msgEl.innerText = 'ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                } else {
                   msgEl.innerText = 'âŒ 5íšŒ ì˜¤ë¥˜ë¡œ ì ì‹œ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.';
                   showAlert("ì¸ì¦ë²ˆí˜¸ë¥¼ 5íšŒ ì´ìƒ í‹€ë ¤ ë³´ì•ˆì„ ìœ„í•´ 10ë¶„ê°„ ì¸ì¦ì´ ì œí•œë©ë‹ˆë‹¤.");
                }
            }
          })
          .catch(err => {
            showLoading(false);
            codeEl.disabled = false;
            btnEl.disabled = false;
            btnEl.innerText = 'í™•ì¸';
            showAlert("ì˜¤ë¥˜: " + err.message);
          });
      }
      
      // -----------------------------------------------------
      // [ì‹ ê·œ] ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ & ì—°ë™ ë¡œì§
      // -----------------------------------------------------

function startKakaoLogin() {
        // [ìˆ˜ì •ë¨] 1. ê³ ìœ  ìƒíƒœê°’ ìƒì„± ì‹œ 'login_' ì ‘ë‘ì–´ í•„ìˆ˜ ì¶”ê°€!
        // ì´ê±¸ ë¶™ì—¬ì•¼ ì„œë²„ê°€ "ì•„, ì´ê±´ íšŒì›ê°€ì…ì´ ì•„ë‹ˆë¼ ê´€ë¦¬í˜ì´ì§€ ë¡œê·¸ì¸ìš©ì´êµ¬ë‚˜"ë¼ê³  ì¸ì‹í•˜ê³  íŒì—…ì„ ë‹«ì•„ì¤ë‹ˆë‹¤.
        var randomStr = Math.random().toString(36).substring(2, 15);
        currentKakaoState = "login_" + randomStr;
        
        // 2. ì¹´ì¹´ì˜¤ ì¸ì¦ URL ìƒì„±
        var kakaoUrl = "https://kauth.kakao.com/oauth/authorize" +
                        "?client_id=" + KAKAO_KEY +
                        "&redirect_uri=" + encodeURIComponent(REDIRECT_URI) +
                        "&response_type=code" +
                        "&state=" + currentKakaoState;
        
        // 3. íŒì—… ì—´ê¸°
        window.open(kakaoUrl, 'kakaoLoginPopup', 'width=480,height=640');
        
        // 4. í´ë§ ì‹œì‘
        showLoading(true);
        document.querySelector('#loadingOverlay div:last-child').innerText = 'ë³´ì•ˆ ì„œë²„ì™€ í†µì‹  ì¤‘ì…ë‹ˆë‹¤....ìµœëŒ€ 5ì´ˆ ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤)';
        
        if(kakaoPollTimer) clearInterval(kakaoPollTimer);
        kakaoPollTimer = setInterval(checkKakaoStatus, 900);
      }

      // 1. checkKakaoStatus í•¨ìˆ˜ ìˆ˜ì • (ë¶ˆì¼ì¹˜ ê°ì§€ ë¡œì§ ì¶”ê°€)
// [MemberManage.html] checkKakaoStatus í•¨ìˆ˜ ìˆ˜ì •ë³¸

function checkKakaoStatus() {
  callApi('checkKakaoLogin', { state: currentKakaoState })
   .then(res => {
      if (res.status === 'WAITING') return;
      
      clearInterval(kakaoPollTimer);
      showLoading(false);

      if (res.status === 'CONNECTED') {
         // ì„±ê³µ
         curData = res.data;
         curMem = { id: curData.memberId, name: curData.name, email: curData.email };
         
         // â˜…â˜…â˜… [ìˆ˜ì •] ì„œë²„ê°€ ë‚´ë ¤ì¤€ 'ì§„ì§œ í† í°'ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. (ê°€ì¥ ì•ˆì „)
         currentAuthCode = curData.sessionToken; 
         
         document.getElementById('loginSection').classList.add('hidden');
         document.getElementById('kakaoLinkSection').classList.add('hidden');
         document.getElementById('dashboardSection').classList.remove('hidden');
         
         renderDash();
         resetLogoutTimer();

         // ì „í™”ë²ˆí˜¸ ë¶ˆì¼ì¹˜ ì²´í¬
         if (curData.phoneMismatch && curData.snsPhone) {
             document.getElementById('diffDbPhone').textContent = curData.phone || "(ì—†ìŒ)";
             document.getElementById('diffSnsPhone').textContent = curData.snsPhone;
             document.getElementById('phoneDiffModal').style.display = 'flex';
         }

      } 
      else if (res.status === 'NOT_LINKED') {
         pendingKakaoId = res.data.kakaoId;
         document.getElementById('loginSection').classList.add('hidden');
         document.getElementById('kakaoLinkSection').classList.remove('hidden');
         showAlert("ğŸ‘‹ ë°˜ê°‘ìŠµë‹ˆë‹¤!\nìµœì´ˆ 1íšŒ, ì¡°í•©ì› ì •ë³´ë¥¼ ì—°ê²°í•´ì£¼ì„¸ìš”.");
      } 
      else {
         showAlert("ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨: " + res.message);
      }
   })
   .catch(e => console.error(e));
}

// 2. [ì‹ ê·œ] SNS ë²ˆí˜¸ë¡œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜ ì¶”ê°€
function updateToSnsPhone() {
    var newPhone = document.getElementById('diffSnsPhone').textContent;
    if(!newPhone) return;

    // ëª¨ë‹¬ ë‹«ê¸°
    document.getElementById('phoneDiffModal').style.display = 'none';
    showLoading(true);

    // ê¸°ì¡´ updateMemberData API ì¬ì‚¬ìš©
    var data = {
        memberId: curMem.id,
        phone: newPhone
    };

    callApi('updateMemberData', { data: data, email: curMem.email, code: currentAuthCode })
      .then(res => {
          showLoading(false);
          if (res.success) {
              showAlert("ì—°ë½ì²˜ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
              // í™”ë©´ì—ë„ ë°˜ì˜
              curData.phone = newPhone;
              renderDash();
          } else {
              showAlert("ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: " + res.message);
          }
      })
      .catch(err => {
          showLoading(false);
          showAlert("ì˜¤ë¥˜: " + err.message);
      });
}

      function cancelKakaoLink() {
         document.getElementById('kakaoLinkSection').classList.add('hidden');
         document.getElementById('loginSection').classList.remove('hidden');
         pendingKakaoId = "";
      }

      // [ì‹ ê·œ] ì—°ë™ìš© ì¡°í•©ì› ì¡°íšŒ
      function handleLinkSearch() {
        var id = document.getElementById('linkMemberId').value;
        if(!id) return showAlert('ì¡°í•©ì› ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        showLoading(true);

        callApi('getMemberForManage', { id: id })
          .then(res => {
            showLoading(false);
            if(!res.success) return showAlert(res.message);
            curMem = res.member; // ì„ì‹œ ì €ì¥
            
            document.getElementById('linkEmailArea').classList.remove('hidden');
            document.getElementById('linkEmailDisplay').value = curMem.email;
            document.getElementById('linkAuthCode').value = '';
          })
          .catch(err => {
            showLoading(false);
            showAlert('ì˜¤ë¥˜: ' + err.message);
          });
      }

      // [ì‹ ê·œ] ì—°ë™ìš© ì¸ì¦ë²ˆí˜¸ ë°œì†¡
      function requestLinkAuth() {
         if(!canSend) { showAlert('ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); return; }
         showLoading(true); canSend=false; setTimeout(()=>{canSend=true;},3000);
         
         callApi('sendExtraEmailAuth', { id: curMem.id })
           .then(res => {
             showLoading(false);
             if(res.result === 'SENT') {
               document.getElementById('linkAuthBox').classList.remove('hidden');
               
               // íƒ€ì´ë¨¸ ì‹œì‘ (ë³€ìˆ˜ ì¬ì‚¬ìš© ì£¼ì˜: ì—¬ê¸°ì„  linkTimer ë³„ë„ ì²˜ë¦¬ ì¶”ì²œí•˜ë‚˜ ê°„ë‹¨íˆ êµ¬í˜„)
               var t = 300;
               var tmr = document.getElementById('linkTimer');
               if(timer) clearInterval(timer);
               timer = setInterval(function() {
                  var m = parseInt(t/60), s = t%60;
                  tmr.textContent = m + ":" + (s<10?"0"+s:s);
                  if(--t < 0) clearInterval(timer);
               }, 1000);

               document.getElementById('linkAuthCode').focus();
               showAlert('ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
             } else {
               showAlert('ë°œì†¡ ì‹¤íŒ¨');
             }
           })
           .catch(e => { showLoading(false); showAlert('ì˜¤ë¥˜:'+e.message); });
      }

      // [ì‹ ê·œ] ì—°ë™ìš© ì¸ì¦ë²ˆí˜¸ í™•ì¸ ë° ìµœì¢… ì—°ê²°
      function verifyLinkAuth() {
         var code = document.getElementById('linkAuthCode').value;
         if(code.length < 6) return showAlert('ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
         
         showLoading(true);
         // ê¸°ì¡´ verifyAuthAndLoadData ëŒ€ì‹ , ë§í¬ ì „ìš© í•¨ìˆ˜ í˜¸ì¶œ
         callApi('linkKakaoAccount', { 
            memberId: curMem.id, 
            email: curMem.email, 
            authCode: code, 
            kakaoId: pendingKakaoId // ì•„ê¹Œ ë°›ì•„ì˜¨ ì¹´ì¹´ì˜¤ ID
         }).then(res => {
            showLoading(false);
            if(res.success) {
               showAlert("ğŸ‰ ì—°ë™ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nì´ì œ ì¹´ì¹´ì˜¤ë¡œ ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸í•˜ì„¸ìš”.", function() {
                  // ì—°ë™ ì„±ê³µ í›„ ë°”ë¡œ ë¡œê·¸ì¸ ì²˜ë¦¬
                  curData = res.data;
                  currentAuthCode = res.sessionToken;
                  
                  document.getElementById('kakaoLinkSection').classList.add('hidden');
                  document.getElementById('dashboardSection').classList.remove('hidden');
                  renderDash();
                  resetLogoutTimer();
               });
            } else {
               showAlert("ì—°ë™ ì‹¤íŒ¨: " + res.message);
            }
         }).catch(err => {
            showLoading(false);
            showAlert("ì˜¤ë¥˜: " + err.message);
         });
      }
      // -----------------------------------------------------

      function logout() { showConfirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", function() { location.reload(); }); }

      function renderDash() {
        var today = new Date();
        var todayStr = String(today.getMonth()+1).padStart(2,'0') + String(today.getDate()).padStart(2,'0');
        var birthMd = (curData.birthDate && curData.birthDate.length >= 4) ? curData.birthDate.substring(2,6) : "";
        
        if(birthMd && birthMd === todayStr) {
           var banner = document.getElementById('birthdayBanner');
           banner.innerHTML = "ğŸ‰ <b>ìƒì¼ ì¶•í•˜ë“œë ¤ìš”!</b><br>í–‡ë¹›ì²˜ëŸ¼ ë¹›ë‚˜ëŠ” í•˜ë£¨ ë˜ì„¸ìš” ğŸ‚";
           banner.style.display = 'block';
        } else {
           document.getElementById('birthdayBanner').style.display = 'none';
        }

        document.getElementById('sumName').textContent = curMem.name;
        document.getElementById('sumId').textContent = curMem.id;
        document.getElementById('sumEmail').textContent = curMem.email;
        document.getElementById('sumAddr').textContent = curData.address || '(ë¯¸ë“±ë¡)';
        document.getElementById('sumPhone').textContent = curData.phone || '-';
        
        var hasAcc = curData.bankName && curData.accountNo;
        document.getElementById('sumAccount').textContent = hasAcc ? curData.bankName + " ******" + curData.accountNo.slice(-4) : "(ë¯¸ë“±ë¡)";
        document.getElementById('btnEditInfo').textContent = hasAcc ? "ë‚´ ì •ë³´ ìˆ˜ì •" : "ë‚´ ì •ë³´ ìˆ˜ì • / ê³„ì¢Œ ë“±ë¡";
        document.getElementById('sumTotal').textContent = (curData.totalPaid||0).toLocaleString() + "ì›";

        var dHtml = "<table style='width:100%; font-size:13px; border-collapse:collapse;'>";
        if(curData.deposits.length > 0) {
           curData.deposits.forEach(d => { dHtml += `<tr style='border-bottom:1px solid #eee;'><td style='padding:5px;'>${d.date}</td><td style='text-align:right;'>${d.amount.toLocaleString()}ì›</td></tr>`; });
        } else { dHtml += "<tr><td style='padding:10px; text-align:center;'>ë‚´ì—­ ì—†ìŒ</td></tr>"; }
        dHtml += "</table>";
        document.getElementById('depositList').innerHTML = dHtml;
        
        document.getElementById('redMax').textContent = (curData.reduction.maxAdditional||0).toLocaleString() + "ì›";
        renderList('redList', curData.reduction.entries, 'cancelReduction');
        renderList('wdList', curData.withdrawal.entries, 'cancelWithdrawal');
      }

      function renderList(id, list, funcName) {
        var h = "";
        list.forEach(i => {
           h += `<div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:13px;">
                  <span>${i.createdAt} ${i.amount?i.amount.toLocaleString()+'ì›': (i.reason || '')}</span>
                  <button class="btn-sub" style="padding:2px 5px;" onclick="${funcName}(${i.rowIndex})" >ì·¨ì†Œ</button>
                 </div>`;
        });
        document.getElementById(id).innerHTML = h;
      }

      function toggleTab(type, btn) {
        var target = document.getElementById('tab' + type.charAt(0).toUpperCase() + type.slice(1));
        var isHidden = target.classList.contains('hidden');
        ['tabExtra','tabReduction','tabWithdraw','tabCert'].forEach(id => document.getElementById(id).classList.add('hidden'));
        document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
        if(isHidden) { target.classList.remove('hidden'); btn.classList.add('active'); }
      }

      function openEditModal() {
        document.getElementById('editModal').style.display = 'flex';
        
        document.getElementById('displayAddr').textContent = curData.address || 'ì—†ìŒ';
        document.getElementById('editPostcode').value = ''; 
        document.getElementById('editRoad').value = ''; 
        document.getElementById('editDetail').value = ''; 

        setPlaceholder('editPhone', curData.phone);
        setPlaceholder('editEmail', curMem.email);
        setPlaceholder('editAccount', curData.accountNo);
        setPlaceholder('editHolder', curData.accountHolder || curMem.name);
        
        document.getElementById('editBank').value = curData.bankName || '';
        
        document.getElementById('emailAuthDone').value = 'true';
        document.getElementById('editAuthBox').classList.add('hidden');
        document.getElementById('btnEditAuth').disabled = true;
        document.getElementById('btnSaveInfo').disabled = false;
        clearError('editAuthMsg');
      }

      function setPlaceholder(id, val) {
         var el = document.getElementById(id);
         el.value = ''; 
         el.placeholder = val ? val : 'ì…ë ¥í•´ì£¼ì„¸ìš”'; 
      }

      function handleEmailChange() {
        var now = document.getElementById('editEmail').value;
        var original = curMem.email;
        
        if(now && now !== original) {
           document.getElementById('emailAuthDone').value = 'false';
           document.getElementById('btnEditAuth').disabled = false;
           document.getElementById('btnSaveInfo').disabled = true;
        } else {
           document.getElementById('emailAuthDone').value = 'true';
           document.getElementById('btnEditAuth').disabled = true;
           document.getElementById('editAuthBox').classList.add('hidden');
           document.getElementById('btnSaveInfo').disabled = false;
        }
      }

      // [ë³€ê²½] fetch ì´ë©”ì¼ ë³€ê²½ ì¸ì¦
      function reqEditAuth() {
         var em = document.getElementById('editEmail').value;
         if(!canSend) { showAlert('ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); return; }
         showLoading(true); canSend=false; setTimeout(()=>{canSend=true;},3000);
         
         callApi('sendEditEmailAuth', { email: em, name: curMem.name })
           .then(res => {
             showLoading(false);
             if(res.result === 'SENT') {
                document.getElementById('editAuthBox').classList.remove('hidden');
                var msgEl = document.getElementById('editAuthMsg');
                msgEl.innerText = 'ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.';
                msgEl.style.color = 'blue';
             } else showAlert(res.result);
           })
           .catch(err => {
             showLoading(false);
             showAlert("ì˜¤ë¥˜: " + err.message);
           });
      }

      // [ë³€ê²½] fetch ì´ë©”ì¼ ë³€ê²½ ì¸ì¦ í™•ì¸
      function verifyEditAuth() {
         var c = document.getElementById('editAuthCode').value;
         var msgEl = document.getElementById('editAuthMsg');
         msgEl.innerText = '';
         if(c.length < 6) { msgEl.innerText='ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”'; return; }
         
         callApi('verifyEmailAuth', { email: document.getElementById('editEmail').value, code: c })
           .then(res => {
             if(res.result === 'OK') {
                document.getElementById('emailAuthDone').value = 'true';
                document.getElementById('btnSaveInfo').disabled = false;
                msgEl.innerText = 'âœ… ì¸ì¦ë˜ì—ˆìŠµë‹ˆë‹¤.';
                msgEl.style.color = 'green';
             } else {
                msgEl.innerText = 'ì¸ì¦ë²ˆí˜¸ ì˜¤ë¥˜';
                msgEl.style.color = 'red';
             }
           })
           .catch(err => {
             msgEl.innerText = "ì˜¤ë¥˜ ë°œìƒ";
           });
      }

      // [ë³€ê²½] fetch ì •ë³´ ì €ì¥
      function saveInfo(btn) {
         if(btn) btn.disabled = true; 
         showLoading(true);
         
         var phoneVal = document.getElementById('editPhone').value.replace(/[^0-9]/g, '');
         if(phoneVal && phoneVal.length < 10) {
             showLoading(false);
             btn.disabled = false;
             return showAlert('ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\nì „ì²´ ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
         }

         var p = document.getElementById('editPostcode').value;
         var r = document.getElementById('editRoad').value;
         var d = document.getElementById('editDetail').value;
         var fullAddr = (p && r) ? `(${p}) ${r} ${d}` : ''; 

         var data = {
           memberId: curMem.id, 
           address: fullAddr,
           phone: document.getElementById('editPhone').value,
           email: document.getElementById('editEmail').value,
           bankName: document.getElementById('editBank').value,
           accountNo: document.getElementById('editAccount').value,
           accountHolder: document.getElementById('editHolder').value
         };
         
         callApi('updateMemberData', { data: data, email: curMem.email, code: currentAuthCode })
           .then(res => {
             showLoading(false);
             if(btn) btn.disabled = false;
             if(res.success) {
                showAlert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', () => {
                  document.getElementById('editModal').style.display = 'none';
                  if(data.email) curMem.email = data.email; 
                  refresh(); 
                });
             } else showAlert('ì €ì¥ ì‹¤íŒ¨: '+res.message);
           })
           .catch(err => {
             showLoading(false);
             if(btn) btn.disabled = false;
             showAlert("ì˜¤ë¥˜: " + err.message);
           });
      }

      function execPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
              var addr = data.roadAddress;
              if(data.buildingName) addr += " ("+data.buildingName+")";
              document.getElementById('editPostcode').value = data.zonecode;
              document.getElementById('editRoad').value = addr;
              document.getElementById('editDetail').focus();
              document.getElementById('layer').style.display = 'none';
            }, width:'100%', height:'100%'
        }).embed(document.getElementById('layer'));
        document.getElementById('layer').style.display = 'block';
      }

      function checkAccountBeforeAction() {
        if(!curData.bankName || !curData.accountNo) {
           showConfirm("í™˜ë¶ˆ ê³„ì¢Œê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nê³„ì¢Œ ë“±ë¡ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", () => { openEditModal(); });
           return false;
        }
        return true;
      }

      function openConsentModal(type, callback) {
        var text = "";
        if(type === 'reduction') {
          text = "<b>[ê°ì ì‹ ì²­ ë™ì˜]</b><br><br>ê°ìëŠ” ë‹¤ìŒë…„ë„ ì´íšŒ ìŠ¹ì¸ í›„ ì²˜ë¦¬ë˜ë©°, ìì‚° ìƒí™©ì— ë”°ë¼ í™˜ê¸‰ì•¡ì´ ì¡°ì •ë  ìˆ˜ ìˆìŒì„ í™•ì¸í•©ë‹ˆë‹¤.";
        } else if(type === 'withdraw') {
          text = "<b>[íƒˆí‡´ ì‹ ì²­ ë™ì˜]</b><br><br>íƒˆí‡´ëŠ” ë‹¤ìŒë…„ë„ ì´íšŒ ìŠ¹ì¸ í›„ ì²˜ë¦¬ë˜ë©°, ìì‚° ìƒí™©ì— ë”°ë¼ í™˜ê¸‰ì•¡ì´ ì¡°ì •ë  ìˆ˜ ìˆìŒì„ í™•ì¸í•©ë‹ˆë‹¤.";
        }
        document.getElementById('consentText').innerHTML = text;
        document.getElementById('modalAgreeCheck').checked = false;
        document.getElementById('btnConsentConfirm').disabled = true;
        document.getElementById('consentModal').style.display = 'flex';
        
        document.getElementById('btnConsentConfirm').onclick = function() {
           document.getElementById('consentModal').style.display = 'none';
           callback(); 
        };
      }

      function submitExtra(btn) {
         var amt = document.getElementById('exAmount').value;
         if(!amt || amt < 10000 || amt%10000!==0) return showAlert('1ì¢Œ(10,000ì›) ì´ìƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
         if(!document.getElementById('exAgree').checked) return showAlert('ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
         
         if(btn) btn.disabled = true;
         var d = { memberId: curMem.id, memberName: curMem.name, amount: amt, status: document.querySelector('input[name="exPaid"]:checked').value === 'yes' ? 'ì…ê¸ˆì™„ë£Œ' : 'ì…ê¸ˆì˜ˆì •' };
         showLoading(true);
         
         callApi('saveContribution', { data: d, email: curMem.email, code: currentAuthCode })
           .then(r => { 
              showLoading(false); 
              if(btn) btn.disabled = false; 
              if(r.success){showAlert('ì™„ë£Œ'); refresh();} else showAlert(r.message); 
           })
           .catch(err => {
              showLoading(false);
              if(btn) btn.disabled = false;
              showAlert("ì˜¤ë¥˜: " + err.message);
           });
      }

      function submitReduction(btn) {
         if(!checkAccountBeforeAction()) return;
         
         var runSubmit = function() {
             var amt = document.getElementById('redAmount').value;
             var max = curData.reduction.maxAdditional || 0;
             if(!amt || amt <= 0) return showAlert('ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.');
             if(Number(amt) > max) return showAlert('ê°ì ê°€ëŠ¥ ê¸ˆì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.\n(ìµœëŒ€ '+max.toLocaleString()+'ì›)');
             
             if(btn) btn.disabled = true;
             var d = { memberId: curMem.id, memberName: curMem.name, reductionAmount: amt };
             showLoading(true);
             
             callApi('saveReduction', { data: d, email: curMem.email, code: currentAuthCode })
               .then(r => { 
                  showLoading(false); 
                  if(btn) btn.disabled = false;
                  if(r.success){showAlert('ê°ì ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'); refresh();} else showAlert(r.message); 
               })
               .catch(err => {
                  showLoading(false);
                  if(btn) btn.disabled = false;
                  showAlert("ì˜¤ë¥˜: " + err.message);
               });
         };

         if(document.getElementById('redAgree').checked) { runSubmit(); } 
         else { openConsentModal('reduction', function() { document.getElementById('redAgree').checked = true; runSubmit(); }); }
      }

      function submitWithdraw(btn) {
         if(!checkAccountBeforeAction()) return;
         
         var runSubmit = function() {
             if(btn) btn.disabled = true;
             var d = { memberId: curMem.id, memberName: curMem.name, reason: document.getElementById('wdReason').value };
             showLoading(true);
             
             callApi('saveWithdrawal', { data: d, email: curMem.email, code: currentAuthCode })
               .then(r => { 
                  showLoading(false);
                  if(btn) btn.disabled = false;
                  if(r.success){showAlert('íƒˆí‡´ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'); refresh();} else showAlert(r.message); 
               })
               .catch(err => {
                  showLoading(false);
                  if(btn) btn.disabled = false;
                  showAlert("ì˜¤ë¥˜: " + err.message);
               });
         };

         if(document.getElementById('wdAgree').checked) { runSubmit(); } 
         else { openConsentModal('withdraw', function() { document.getElementById('wdAgree').checked = true; runSubmit(); }); }
      }

      function cancelReduction(rowIndex) { 
          showConfirm("ì·¨ì†Œ ì‹ ì²­ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì‹ ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", function() {
              showLoading(true); 
              callApi('cancelReduction', { rowIndex: rowIndex, email: curMem.email, code: currentAuthCode })
                .then(r => { 
                   showLoading(false); 
                   if(r.success) showAlert('ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                   refresh(); 
                })
                .catch(err => showAlert("ì˜¤ë¥˜: " + err.message));
          });
      }
      
      function cancelWithdrawal(rowIndex) { 
          showConfirm("ì·¨ì†Œ ì‹ ì²­ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì‹ ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", function() {
              showLoading(true); 
              callApi('cancelWithdrawal', { rowIndex: rowIndex, email: curMem.email, code: currentAuthCode })
                .then(r => { 
                   showLoading(false); 
                   if(r.success) showAlert('ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                   refresh(); 
                })
                .catch(err => showAlert("ì˜¤ë¥˜: " + err.message));
          });
      }
      
      // [ë³€ê²½] fetch ì¦ëª…ì„œ ë‹¤ìš´ë¡œë“œ (Base64 -> PDF)
      function downloadCert(btn) {
          if(!currentAuthCode) { showAlert('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'); return; }
          if(btn) btn.disabled = true; 
          
          showLoading(true); 
          
          var timeout = setTimeout(function() {
              showLoading(false);
              if(btn) btn.disabled = false;
              showAlert("ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
          }, 30000);

          callApi('downloadCertPdf', { id: curMem.id, email: curMem.email, code: currentAuthCode })
            .then(res => {
                clearTimeout(timeout); 
                showLoading(false);
                if(btn) btn.disabled = false;
                
                if (res.success) {
                   try {
                       var binaryString = window.atob(res.base64);
                       var len = binaryString.length;
                       var bytes = new Uint8Array(len);
                       for (var i = 0; i < len; i++) {
                           bytes[i] = binaryString.charCodeAt(i);
                       }
                       var blob = new Blob([bytes], {type: "application/pdf"});
                       
                       var link = document.createElement('a');
                       link.href = window.URL.createObjectURL(blob);
                       link.download = res.fileName;
                       document.body.appendChild(link); 
                       link.click();
                       document.body.removeChild(link); 
                       
                       showAlert("ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n(íŒŒì¼ì´ ì—´ë¦¬ì§€ ì•Šìœ¼ë©´ íŒì—… ì°¨ë‹¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”)");
                   } catch (e) {
                       console.error(e);
                       showAlert("íŒŒì¼ ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                   }
                } else {
                   showAlert(res.message);
                }
            })
            .catch(err => {
                clearTimeout(timeout);
                showLoading(false);
                if(btn) btn.disabled = false;
                showAlert("ì‹œìŠ¤í…œ ì˜¤ë¥˜: " + err.message);
            });
      }

      function refresh() { 
          if(!currentAuthCode) { showAlert('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì¡°íšŒí•´ì£¼ì„¸ìš”.', function(){ location.reload(); }); return; }
          showLoading(true);
          callApi('verifyAuthAndLoadData', { id: curMem.id, email: curMem.email, code: currentAuthCode })
            .then(r => {
                showLoading(false); 
                curData=r; 
                renderDash(); 
                resetLogoutTimer(); 
            })
            .catch(err => {
                showLoading(false);
                showAlert("ê°±ì‹  ì˜¤ë¥˜: " + err.message);
            });
      }

      // [ì‹ ê·œ] ë„¤ì´ë²„ ë¡œê·¸ì¸ & ì—°ë™ ë¡œì§
// ì¹´ì¹´ì˜¤ì™€ ë™ì¼í•œ êµ¬ì¡°ì´ë©°, ì‹ë³„ìë§Œ Naverë¡œ ë³€ê²½ë¨

var naverPollTimer = null;
var currentNaverState = "";

function startNaverLogin() {
  // 1. state ìƒì„± (íŒì—… êµ¬ë¶„ì„ ìœ„í•´ 'naver_login_' ì ‘ë‘ì–´ ì‚¬ìš©)
  var randomStr = Math.random().toString(36).substring(2, 15);
  currentNaverState = "naver_login_" + randomStr;
  
  // 2. Client ID (ë‚˜ì¤‘ì— HTMLì—ë„ ìƒìˆ˜ë¡œ ì„ ì–¸ í•„ìš”)
  var NAVER_CLIENT_ID = "ì—¬ê¸°ì—_Client_ID_ì…ë ¥"; // â˜… í‚¤ ë°œê¸‰ í›„ ì…ë ¥ í•„ìš”
  
  if (NAVER_CLIENT_ID === "ì—¬ê¸°ì—_Client_ID_ì…ë ¥") {
     return showAlert("ë„¤ì´ë²„ ë¡œê·¸ì¸ì€ ì•„ì§ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.");
  }

  // 3. URL ìƒì„±
  var naverUrl = "https://nid.naver.com/oauth2.0/authorize" +
                  "?response_type=code" +
                  "&client_id=" + NAVER_CLIENT_ID +
                  "&redirect_uri=" + encodeURIComponent(REDIRECT_URI) +
                  "&state=" + currentNaverState;
  
  // 4. íŒì—… & í´ë§
  window.open(naverUrl, 'naverLoginPopup', 'width=480,height=640');
  showLoading(true);
  
  if(naverPollTimer) clearInterval(naverPollTimer);
  naverPollTimer = setInterval(checkNaverStatus, 1500);
}

function checkNaverStatus() {
  callApi('checkNaverLogin', { state: currentNaverState })
   .then(res => {
      if (res.status === 'WAITING') return;
      
      clearInterval(naverPollTimer);
      showLoading(false);

      if (res.status === 'CONNECTED') {
         // ì„±ê³µ
         curData = res.data;
         curMem = { id: curData.memberId, name: curData.name, email: curData.email };
         currentAuthCode = "NAVER_PASSED_" + currentNaverState;
         
         document.getElementById('loginSection').classList.add('hidden');
         document.getElementById('kakaoLinkSection').classList.add('hidden'); // ì¹´ì¹´ì˜¤ ì„¹ì…˜ ì¬ì‚¬ìš©í•˜ê±°ë‚˜ ë³„ë„ ì„¹ì…˜ í•„ìš”
         document.getElementById('dashboardSection').classList.remove('hidden');
         renderDash();
         resetLogoutTimer();
      } 
      else if (res.status === 'NOT_LINKED') {
         // ë¯¸ì—°ë™ -> ë§¤ì¹­ í™”ë©´ (ì¹´ì¹´ì˜¤ì™€ UI ê³µìœ  ê°€ëŠ¥)
         // pendingKakaoId ëŒ€ì‹  pendingNaverId ì‚¬ìš© í•„ìš”
         // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ ì•Œë¦¼ë§Œ ë„ì›€ (ì¶”í›„ UI í†µí•© í•„ìš”)
         showAlert("ë„¤ì´ë²„ ê³„ì •ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.\nì—°ë™ ê¸°ëŠ¥ì€ UI ì¶”ê°€ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      } 
      else {
         showAlert("ë„¤ì´ë²„ ë¡œê·¸ì¸ ì‹¤íŒ¨: " + res.message);
      }
   })
   .catch(e => console.error(e));
}
    </script>
    <script>
      console.log("%c ìš©ì¸ëª¨ë‘ì˜í–‡ë¹›í˜‘ë™ì¡°í•© %c System Ready ", "background: #006837; color: #ffffff; padding: 5px; border-radius: 4px; font-weight: bold;", "background: #333; color: #fff; padding: 5px; border-radius: 4px;");
    </script>
    <div id="phoneDiffModal" class="center-modal" style="display:none; z-index: 100001;">
   <div class="modal-content" style="text-align: left;">
      <div style="text-align:center; font-size:40px; margin-bottom:10px;">ğŸ“²</div>
      <h3 style="margin:0 0 10px 0; text-align:center;">ì—°ë½ì²˜ê°€ ë³€ê²½ë˜ì—ˆë‚˜ìš”?</h3>
      
      <p style="font-size:14px; color:#555; margin-bottom:20px; line-height:1.5;">
         ì¡°í•©ì— ë“±ë¡ëœ ë²ˆí˜¸ì™€ ì¹´ì¹´ì˜¤ ê³„ì •ì˜ ë²ˆí˜¸ê°€ ë‹¤ë¦…ë‹ˆë‹¤.<br>
         ìµœì‹  ë²ˆí˜¸ë¡œ ì—…ë°ì´íŠ¸ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
      </p>

      <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid #eee;">
         <div style="font-size:12px; color:#999;">í˜„ì¬ ë“±ë¡ëœ ë²ˆí˜¸</div>
         <div id="diffDbPhone" style="font-weight:bold; margin-bottom:10px; color:#555;">-</div>
         
         <div style="font-size:12px; color:#1967d2;">ì¹´ì¹´ì˜¤(ìµœì‹ ) ë²ˆí˜¸</div>
         <div id="diffSnsPhone" style="font-weight:bold; color:#1967d2; font-size:16px;">-</div>
      </div>

      <div style="display:flex; gap:10px;">
         <button onclick="document.getElementById('phoneDiffModal').style.display='none'" type="button" style="flex:1; background:#f1f3f4; color:#333; border:none; padding:12px; border-radius:6px; font-weight:bold; cursor:pointer;">ì•„ë‹ˆì˜¤</button>
         <button onclick="updateToSnsPhone()" type="button" style="flex:1; background:#4e8cff; color:white; border:none; padding:12px; border-radius:6px; font-weight:bold; cursor:pointer;">ë„¤, ë³€ê²½í• ê²Œìš”</button>
      </div>
   </div>
</div>
  </body>
</html>
